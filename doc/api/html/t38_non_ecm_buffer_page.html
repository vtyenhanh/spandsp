<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>spandsp: T.38 rate adapting non-ECM image data buffer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="css.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">spandsp
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('t38_non_ecm_buffer_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">T.38 rate adapting non-ECM image data buffer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="t38_non_ecm_buffer_page_sec_1"></a>
What does it do?</h1>
<p>The T.38 rate adapting non-ECM image data buffer is used to buffer TCF and non-ECM FAX image data being gatewayed from a T.38 link to an analogue FAX modem link.</p>
<p>As well as rate adapting, the buffer has the ability to impose a minimum on the number of bits per row of image data. This allows any row padding zeros to be stripped from the data stream, to minimise the data sent as T.38 packets, and be reinserted before the data is sent to its final destination. Not all T.38 implementations support this feature, so it's use must be negotiated.</p>
<h1><a class="anchor" id="t38_non_ecm_buffer_page_sec_2"></a>
How does it work?</h1>
<p>When inserting padding bits, whether to ensure a minimum row time or for flow control, it is important the right value is inserted at the right point in the data sequence. If we are in the optional initial period of all ones, we can insert a byte of extra ones at any time. Once we pass that initial stage, TCF and image data need separate handling.</p>
<p>TCF data is all zeros. Once the period of all zeros has begun it is OK to insert additional bytes of zeros at any point.</p>
<p>Image data consists of rows, separated by EOL (end of line) markers. Inserting zeros at arbitrary times would corrupt the image. However, it is OK to insert a considerable number of extra zeros just before an EOL. Therefore we track where the EOL markers occur as we fill the buffer. As we empty the buffer stop outputting real data, and start outputting bytes of zero, if we reach this last EOL marker location. The EOL marker is 11 zeros following by 1 (1D mode) or 2 (2D mode) ones. Therefore, it always spills across 2 bytes in the buffer, and there is always a point where we can insert our extra zeros between bytes.</p>
<p>Padding between the group of successive EOL markers which for the RTC (return to control) marker that ends an image causes some FAX machines not to recognise them as an RTC condition. Therefore, our padding applies special protection so padding never occurs between two successive EOL markers, with no pixel data between them. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
