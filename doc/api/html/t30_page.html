<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>spandsp: T.30 FAX protocol handling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="css.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">spandsp
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('t30_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">T.30 FAX protocol handling </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="t30_page_sec_1"></a>
What does it do?</h1>
<p>The T.30 protocol is the core protocol used for FAX transmission. This module implements most of its key features. It does not interface to the outside world. Seperate modules do that for T.38, analogue line, and other forms of FAX communication.</p>
<p>Current features of this module include: </p><pre class="fragment">- FAXing to and from multi-page TIFF/F files, whose images are one of the standard
  FAX sizes.
- V.27ter, V.29 and V.17 modes (2400bps, to 14,400bps).
- T.4 1D (MH), T.4 2D,(MR) and T.6 (MMR) compression.
- Error correction mode (ECM).
- All standard horizonal resolutions (R8, R16, 300dpi, 600dpi, 800dpi, 1200dpi).
- All standard vertical resolutions (standard, fine, superfine, 300dpi, 600dpi, 800dpi, 1200dpi).
- All standard page widths (A4, B4, A3).
- All standard page lengths (A4, B4, North American letter, North American legal, continuous).
- Monitoring and sending identifier strings (CSI, TSI, and CIG).
- Monitoring and sending sub-address strings (SUB).
- Monitoring and sending polling sub-addresses (SEP).
- Monitoring and sending polled sub-addresses (PSA).
- Monitoring and sending sender identifications (SID).
- Monitoring and sending passwords (PWD).
- Monitoring of non-standard facility frames (NSF, NSC, and NSS).
- Sending custom non-standard facility frames (NSF, NSC, and NSS).
- Analogue modem and T.38 operation.
</pre><h1><a class="anchor" id="t30_page_sec_2"></a>
How does it work?</h1>
<p>Some of the following is paraphrased from some notes found a while ago on the Internet. I cannot remember exactly where they came from, but they are useful.</p>
<h2><a class="anchor" id="t30_page_sec_2a"></a>
The answer (CED) tone</h2>
<p>The T.30 standard says an answering fax device must send CED (a 2100Hz tone) for approximately 3 seconds before sending the first handshake message. Some machines send an 1100Hz or 1850Hz tone, and some send no tone at all. In fact, this answer tone is so unpredictable, it cannot really be used. It should, however, always be generated according to the specification.</p>
<h2><a class="anchor" id="t30_page_sec_2b"></a>
Common Timing Deviations</h2>
<p>The T.30 spec. specifies a number of time-outs. For example, after dialing a number, a calling fax system should listen for a response for 35 seconds before giving up. These time-out periods are as follows: </p><pre class="fragment">- T1 - 35+-5s: the maximum time for which two fax system will attempt to identify each other
- T2 - 6+-1s:  a time-out used to start the sequence for changing transmit parameters
- T3 - 10+-5s: a time-out used in handling operator interrupts
- T5 - 60+-5s: a time-out used in error correction mode
</pre><p>These time-outs are sometimes misinterpreted. In addition, they are routinely ignored, sometimes with good reason. For example, after placing a call, the calling fax system is supposed to wait for 35 seconds before giving up. If the answering unit does not answer on the first ring or if a voice answering machine is connected to the line, or if there are many delays through the network, the delay before answer can be much longer than 35 seconds.</p>
<p>Fax units that support error correction mode (ECM) can respond to a post-image handshake message with a receiver not ready (RNR) message. The calling unit then queries the receiving fax unit with a receiver ready (RR) message. If the answering unit is still busy (printing for example), it will repeat the RNR message. According to the T.30 standard, this sequence (RR/RNR RR/RNR) can be repeated for up to the end of T5 (60+-5s). However, many fax systems ignore the time-out and will continue the sequence indefinitely, unless the user manually overrides.</p>
<p>All the time-outs are subject to alteration, and sometimes misuse. Good T.30 implementations must do the right thing, and tolerate others doing the wrong thing.</p>
<h2><a class="anchor" id="t30_page_sec_2c"></a>
Variations in the inter-carrier gap</h2>
<p>T.30 specifies 75+-20ms of silence between signals using different modulation schemes. Examples are between the end of a DCS signal and the start of a TCF signal, and between the end of an image and the start of a post-image signal. Many fax systems violate this requirement, especially for the silent period between DCS and TCF. This may be stretched to well over 100ms. If this period is too long, it can interfere with handshake signal error recovery, should a packet be corrupted on the line. Systems should ensure they stay within the prescribed T.30 limits, and be tolerant of others being out of spec..</p>
<h2><a class="anchor" id="t30_page_sec_2d"></a>
Other timing variations</h2>
<p>Testing is required to determine the ability of a fax system to handle variations in the duration of pauses between unacknowledged handshake message repetitions, and also in the pauses between the receipt of a handshake command and the start of a response to that command. In order to reduce the total transmission time, many fax systems start sending a response message before the end of the command has been received.</p>
<h2><a class="anchor" id="t30_page_sec_2e"></a>
Other deviations from the T.30 standard</h2>
<p>There are many other commonly encountered variations between machines, including: </p><pre class="fragment">- frame sequence deviations
- preamble and flag sequence variations
- improper EOM usage
- unusual data rate fallback sequences
- common training pattern detection algorithms
- image transmission deviations
- use of the talker echo protect tone
- image padding and short lines
- RTP/RTN handshake message usage
- long duration lines
- nonstandard disconnect sequences
- DCN usage
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
