<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>spandsp: The V.29 receiver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="css.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">spandsp
   &#160;<span id="projectnumber">3.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('v29rx_page.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The V.29 receiver </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="v29rx_page_sec_1"></a>
What does it do?</h1>
<p>The V.29 receiver implements the receive side of a V.29 modem. This can operate at data rates of 9600, 7200 and 4800 bits/s. The audio input is a stream of 16 bit samples, at 8000 samples/second. The transmit and receive side of V.29 modems operate independantly. V.29 is mostly used for FAX transmission, where it provides the standard 9600 and 7200 bits/s rates (the 4800 bits/s mode is not used for FAX).</p>
<h1><a class="anchor" id="v29rx_page_sec_2"></a>
How does it work?</h1>
<p>V.29 operates at 2400 baud for all three bit rates. It uses 16-QAM modulation for 9600bps, 8-QAM for 7200bps, and 4-PSK for 4800bps. A training sequence is specified at the start of transmission, which makes the design of a V.29 receiver relatively straightforward.</p>
<p>The first stage of the training sequence consists of 128 symbols, alternating between two constellation positions. The receiver monitors the signal power, to sense the possible presence of a valid carrier. When the alternating signal begins, the power rising above a minimum threshold (-26dBm0) causes the main receiver computation to begin. The initial measured power is used to quickly set the gain of the receiver. After this initial settling, the front end gain is locked, and the adaptive equalizer tracks any subsequent signal level variation. The signal is oversampled to 24000 samples/second (i.e. signal, zero, zero, signal, zero, zero, ...) and fed to a complex root raised cosine pulse shaping filter. This filter has been modified from the conventional root raised cosine filter, by shifting it up the band, to be centred at the nominal carrier frequency. This filter interpolates the samples, pulse shapes, and performs a fractional sample delay at the same time. 48 sets of filter coefficients are used to achieve a set of finely spaces fractional sample delays, between zero and one sample. By choosing every fifth sample, and the appropriate set of filter coefficients, the properly tuned symbol tracker can select data samples at 4800 samples/second from points within 1.125 degrees of the centre and mid-points of each symbol. The output of the filter is multiplied by a complex carrier, generated by a DDS. The result is a baseband signal, requiring no further filtering, apart from an adaptive equalizer. The baseband signal is fed to a T/2 adaptive equalizer. A band edge component maximisation algorithm is used to tune the sampling, so the samples fed to the equalizer are close to the mid point and edges of each symbol. Initially the algorithm is very lightly damped, to ensure the symbol alignment pulls in quickly. Because the sampling rate will not be precisely the same as the transmitter's (the spec. says the symbol timing should be within 0.01%), the receiver constantly evaluates and corrects this sampling throughout its operation. During the symbol timing maintainence phase, the algorithm uses a heavier damping.</p>
<p>The carrier is specified as 1700Hz +-1Hz at the transmitter, and 1700 +-7Hz at the receiver. The receive carrier would only be this inaccurate if the link includes FDM sections. These are being phased out, but the design must still allow for the worst case. Using an initial 1700Hz signal for demodulation gives a worst case rotation rate for the constellation of about one degree per symbol. Once the symbol timing synchronisation algorithm has been given time to lock to the symbol timing of the initial alternating pattern, the phase of the demodulated signal is recorded on two successive symbols - once for each of the constellation positions. The receiver then tracks the symbol alternations, until a large phase jump occurs. This signifies the start of the next phase of the training sequence. At this point the total phase shift between the original recorded symbol phase, and the symbol phase just before the phase jump occurred is used to provide a coarse estimation of the rotation rate of the constellation, and it current absolute angle of rotation. These are used to update the current carrier phase and phase update rate in the carrier DDS. The working data already in the pulse shaping filter and equalizer buffers is given a similar step rotation to pull it all into line. From this point on, a heavily damped integrate and dump approach, based on the angular difference between each received constellation position and its expected position, is sufficient to track the carrier, and maintain phase alignment. A fast rough approximator for the arc-tangent function is adequate for the estimation of the angular error.</p>
<p>The next phase of the training sequence is a scrambled sequence of two particular symbols. We train the T/2 adaptive equalizer using this sequence. The scrambling makes the signal sufficiently diverse to ensure the equalizer converges to the proper generalised solution. At the end of this sequence, the equalizer should be sufficiently well adapted that is can correctly resolve the full QAM constellation. However, the equalizer continues to adapt throughout operation of the modem, fine tuning on the more complex data patterns of the full QAM constellation.</p>
<p>In the last phase of the training sequence, the modem enters normal data operation, with a short defined period of all ones as data. As in most high speed modems, data in a V.29 modem passes through a scrambler, to whiten the spectrum of the signal. The transmitter should initialise its data scrambler, and pass the ones through it. At the end of the ones, real data begins to pass through the scrambler, and the transmit modem is in normal operation. The receiver tests that ones are really received, in order to verify the modem trained correctly. If all is well, the data following the ones is fed to the application, and the receive modem is up and running. Unfortunately, some transmit side of some real V.29 modems fail to initialise their scrambler before sending the ones. This means the first 23 received bits (the length of the scrambler register) cannot be trusted for the test. The receive modem, therefore, only tests that bits starting at bit 24 are really ones. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
